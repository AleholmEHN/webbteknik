<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flashcards</title>
  <style>
    body {
        width: 600px;
        margin: auto;
        font-family: sans-serif;
    }
    .flashcards {
        position: relative;
        height: 224px;
        width: 324px;
        margin: 30px 0;
        overflow-x: hidden; /* Destroys perspective */
           -moz-transform-style: preserve-3d;
        -webkit-transform-style: preserve-3d;
           -moz-perspective: 800px;
        -webkit-perspective: 800px; /* TODO: Investigate why this has no effect */
    }
    .flashcards.flipped {
        /* Currently unused */
    }
    .flashcards > dt, .flashcards > dd  {
        display: none;
        position: absolute;
        left: 0;
        top: 0;
        height: 200px;
        width: 300px;
        margin: 0;
        padding: 10px;
        border: 1px solid #333;
        border-radius: 5px;
           -moz-backface-visibility: hidden;
        -webkit-backface-visibility: hidden; /* TODO: Investigate why this has no effect */
           -moz-transform-style: preserve-3d;
        -webkit-transform-style: preserve-3d;
           -moz-transition: 0.7s linear;
        -webkit-transition: 0.7s linear;
        /* Would lie the following not to override the above... CSS animation ? */
        /*
           -moz-transition: left 0.5s linear;
        -webkit-transition: left 0.5s linear;
        */
        /* TODO: No delay for z-index when 3D transform is not supported */
        font-size: x-large;
        background-color: #DFFA00;
        box-shadow: 5px 5px 5px silver;
    }
    .flashcards > dt  {
        font-size: xx-large;
        text-align: center;
        line-height: 2;
        background-color: #FFDF00;
    }
    .flashcards > .activecard {
        display: block;
           -moz-transform: rotateY(0deg);
        -webkit-transform: rotateY(0deg);
    }
    .flashcards > dt.activecard {
        z-index: 10;
        /* translateZ hides backface of dt during transition */
           -moz-transform: translateZ(0) rotateY(0deg);
        -webkit-transform: translateZ(0) rotateY(0deg);
        /* TODO: Investigate why translateZ no hiding effect in Webkit
           I'm using a non transparent background so it does not matter now */
    }
    /* Todo: Trigger with JS */
    .flashcards.flipped > dt.activecard {
           -moz-transform: translateZ(0) rotateY(180deg);
        -webkit-transform: translateZ(0) rotateY(180deg);
        z-index: 1;
    }
    .flashcards > dd.activecard {
        z-index: 1;
           -moz-transform: translateZ(0) rotateY(180deg);
        -webkit-transform: translateZ(0) rotateY(180deg);
    }
    .flashcards.flipped > dd.activecard {
        z-index: 10;
           -moz-transform: translateZ(0) rotateY(360deg);
        -webkit-transform: translateZ(0) rotateY(360deg);
    }
    /* Sideay slide */
    /* TODO: (Fix) This animation gives away the answer when 3D is not supported */
    /* It also looks bad when clicking the button while flipped */
    /* TODO: Tilt 45 deg + transform-origin */
    .flashcards > dt.nextcard {
        display: block;
        left: 324px;
    }
    .flashcards > dt.prevcard {
        display: block;
        left: -324px;
    }
  </style>
</head>
<body>
  <h1>Flashcards using CSS 3D transformations and a definition list</h1>
  <p>Click the card to flip it. View source to check out how it's done and plans for the future.</p>
  <p>Requires Firefox 10 or later. Also tested in Chromium. It should work in Safari (untested).</p>
  <p>Keyboard support:</p>
  <dl>
    <dt>Space</dt>
    <dd>Flip card</dd>
    <dt>Key left</dt>
    <dd>Previous card</dd>
    <dt>Key right</dt>
    <dd>Next card</dd>
  </dl>
  <dl class="flashcards" id="flashcards">
    <dt>GPU</dt>
    <dd>Graphics Processing Unit</dd>
    <dt class="prevcard">RAM</dt>
    <dd class="prevcard">Random Access Memory</dd>
    <dt class="activecard">CPU</dt>
    <dd class="activecard">Central Processing Unit</dd>
    <dt class="nextcard">USB</dt>
    <dd class="nextcard">Universal Serial Bus</dd>
    <dt>SSD</dt>
    <dd>Solid State Drive</dd>
    <dt>GUI</dt>
    <dd>Graphical User Interface</dd>
    <dt>TUI</dt>
    <dd>Text User Interface</dd>
    <dt>CLI</dt>
    <dd>Command Line Interface</dd>
  </dl>
  <p>
    <button id="goto_prevcard">Previous</button>
    <span id="curnum">3</span>/<span id="totnum">8</span><!-- Todo: Calculate these -->
    <button id="goto_nextcard">Next</button>
  </p>
  <script>
    /*
      What to capability detect?
        - classList
        - querySelectorAll
        - previousElementSibling & nextElementSibling
        - 3D-transforms...
        - transitionend
    */
    var the_list = document.getElementById("flashcards");
    var cur_num  = 1 * document.getElementById("curnum").innerHTML;
    var tot_num  = 1 * document.getElementById("totnum").innerHTML;
    
    if ( cur_num === tot_num ) {
    	document.getElementById("goto_nextcard").disabled = "disabled";
    } else {
    	document.getElementById("goto_nextcard").removeAttribute("disabled");
    }
    if ( cur_num === 1 ) {
    	document.getElementById("goto_prevcard").disabled = "disabled";
    } else {
    	document.getElementById("goto_prevcard").removeAttribute("disabled");
    }

    var flipcard = function () {
        the_list.classList.toggle("flipped"); // temp solution with global var
    	if ( !the_list.classList.contains("flipped") ) {
    		setTimeout( function () {
    			move_forward_or_backward("next");
    		}, 700);
    		/* TODO: Set with transition-end instead of timeOut */
    	}
    }
    var move_forward_or_backward = function (direction) {
        // Avoid live DOM Collections by using querySelector
        var active_cards = the_list.querySelectorAll(".activecard");
        var prev_cards   = the_list.querySelectorAll(".prevcard");
        var next_cards   = the_list.querySelectorAll(".nextcard");

        // Are there any more cards in the list?
        var cards_before_prev = prev_cards.length && prev_cards[0].previousElementSibling;
        var cards_after_next  = next_cards.length && next_cards[1].nextElementSibling;

        if ( direction === "next" && next_cards.length ) {
            if ( cards_after_next ) {
              next_cards[1].nextElementSibling.classList.add("nextcard");
              next_cards[1].nextElementSibling.nextElementSibling.classList.add("nextcard");
            } else {
                // TODO: Disable button
                // And find a way to-re-enable when moving the other way
                document.getElementById("goto_nextcard").disabled = "disabled";
            }
            document.getElementById("goto_prevcard").removeAttribute("disabled");
            
            next_cards[0].classList.remove("nextcard");
            next_cards[1].classList.remove("nextcard");
            next_cards[0].classList.add("activecard");
            next_cards[1].classList.add("activecard");

            active_cards[0].classList.remove("activecard");
            active_cards[1].classList.remove("activecard");
            active_cards[0].classList.add("prevcard");
            active_cards[1].classList.add("prevcard");

            if ( prev_cards.length ) {
                prev_cards[0].classList.remove("prevcard");
                prev_cards[1].classList.remove("prevcard");
            }
            document.getElementById("curnum").innerHTML = ++cur_num;

        } else if ( direction === "prev" && prev_cards.length ) {

          if ( cards_before_prev ) {
                 prev_cards[0].previousElementSibling.classList.add("prevcard");
                 prev_cards[0].previousElementSibling.previousElementSibling.classList.add("prevcard");
            } else {
                // TODO: Disable button
                // And find a way to-re-enable when moving the other way
                document.getElementById("goto_prevcard").disabled = "disabled";
            }
          document.getElementById("goto_nextcard").removeAttribute("disabled");
          
            prev_cards[0].classList.remove("prevcard");
            prev_cards[1].classList.remove("prevcard");
            prev_cards[0].classList.add("activecard");
            prev_cards[1].classList.add("activecard");

            active_cards[0].classList.remove("activecard");
            active_cards[1].classList.remove("activecard");
            active_cards[0].classList.add("nextcard");
            active_cards[1].classList.add("nextcard");

            if ( next_cards.length ) {
              next_cards[0].classList.remove("nextcard");
              next_cards[1].classList.remove("nextcard");
            }
            document.getElementById("curnum").innerHTML = --cur_num;

        } else {
            // TODO: Round robin ?
        }
    };

    var goto_next = function () {
    	if ( the_list.classList.contains("flipped") ) {
    		the_list.classList.remove ("flipped");
    		setTimeout( function () {
    			move_forward_or_backward("next");
    		}, 700);
    		/* TODO: Set with transition-end instead of timeOut */
    	} else {
            move_forward_or_backward("next");
    	}
    }
    var goto_prev = function () {
    	if ( the_list.classList.contains("flipped") ) {
    		the_list.classList.remove ("flipped");
    		setTimeout( function () {
    			move_forward_or_backward("prev");
    		}, 700);
    		/* TODO: Set with transition-end instead of timeOut */
    	} else {
            move_forward_or_backward("prev");
    	}
    }
    the_list.onclick = flipcard;
    document.getElementById("goto_nextcard").onclick = goto_next;
    document.getElementById("goto_prevcard").onclick = goto_prev;
    window.onkeydown = function (e) {
        switch (e.keyCode) {
		case 32:
			flipcard();
			return false;
		case 37:
			goto_prev();
			return false;
		case 39:
			goto_next();
			return false;
        }
        return true;
    }

  </script>
  <!-- 
  TODO major items:
  * Support MS and Opera
  * Keyboard support
    - Flip using space
    - Previous/next using arrows
  * A nice design...
    - Have the dt text expand and fill the whole Flash-card - adapting the size dependong on length of content
    - Color 
    - Font
    - Images
  * Numbering items
    - Show number in lower right corner
    - Toggle URL hash (or push state)
    - Go to specific item depending on URL hash
  * Show full list and goto specific item
  * Mobile design:
    - Fullscreen
    - Gestures for forward and back
    - Offline storage
    - Portrait toggle = View header and full list (only DT) + kinetic scroll
    - Landscape toggle = View individual Flash card
  * Presentation mode for classrooms
  * PHP backend
  * Admin interface to add/edit items and complete lists
   -->
</body>
</html>
